<!DOCTYPE html>
<html>
  <head>
    <title>Lake Norman VR Experience</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  </head>

  <body>
    <a-scene>
      <!-- Assets -->
      <a-assets>
        <video
          id="video360"
          src="Video_Generation_From_Image.mp4"
          autoplay
          loop
          muted
          playsinline
          crossorigin="anonymous">
        </video>
      </a-assets>

      <!-- 360° Background -->
      <a-videosphere src="#video360" rotation="0 -90 0"></a-videosphere>

      <!-- BOX 1 (center) -->
      <a-box
        id="box1"
        position="0 1.6 -3"
        color="#A52A2A"
        depth="0"
        height="0.4"
        width="0.4">
      </a-box>

      <!-- TEXT 1 -->
      <a-entity id="text1Wrapper" look-at="[camera]" visible="false">
        <a-text
          id="text1"
          value="The sky is on fire.\nMeteors scream through the clouds, tearing the earth apart.\nYou’re standing on the shores of ancient Lake Norman — moments before extinction."
          position="0 2.0 -3"
          align="center"
          color="#FFF"
          width="4"
          scale="0.5 0.5 0.5">
        </a-text>
      </a-entity>

      <!-- BOX 2 (blue, further right) -->
      <a-box
        id="box2"
        position="2.5 1.6 -3"
        color="#4682B4"
        depth="0"
        height="0.4"
        width="0.4"
        visible="false">
      </a-box>

      <!-- TEXT 2 -->
      <a-entity id="text2Wrapper" look-at="[camera]" visible="false">
        <a-text
          id="text2"
          value="The ground shakes as the impact ripples across the land.\nForests ignite. Dinosaurs collapse in clouds of ash.\nThe Age of Reptiles ends in fire."
          position="2.5 1 -3"
          align="center"
          color="#FFF"
          width="4"
          scale="0.7 0.7 0.7">
        </a-text>
      </a-entity>

      <!-- BOX 3 (green, further left) -->
      <a-box
        id="box3"
        position="-2.5 1.6 -3"
        color="#228B22"
        depth="0"
        height="0.4"
        width="0.4"
        visible="false">
      </a-box>

      <!-- TEXT 3 -->
      <a-entity id="text3Wrapper" look-at="[camera]" visible="false">
        <a-text
          id="text3"
          value="The firestorm fades.\nAsh drifts across a silent lake.\nWhat was once alive now sleeps beneath the earth."
          position="-2.5 2.1 -3"
          align="center"
          color="#FFF"
          width="4"
          scale="0.7 0.7 0.7">
        </a-text>
      </a-entity>

      <!-- Camera + cursor -->
      <a-entity camera look-controls position="0 1.6 0">
        <a-entity 
          cursor="fuse: false"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015"
          material="color: white; shader: flat">
        </a-entity>
      </a-entity>

          <a-entity id="uiPanelRoot" position="-0.8 1.0 -2.0" rotation="0 0 0">

      <!-- Button: Present -->
      <a-entity id="btnPresent" class="clickable"
                ui-button="url: fall_present.html; label: Present"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 0 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Present; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Past -->
      <a-entity id="btnPast" class="clickable"
                ui-button="url: fall_past.html; label: Past"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.11 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Past; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Future -->
      <a-entity id="btnFuture" class="clickable"
                ui-button="url: fall_future.html; label: Future"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.22 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Future; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Home -->
      <a-entity id="btnHome" class="clickable"
                ui-button="url: index.html; label: Home"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.33 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Home; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

     </a-entity>
    <!-- ===== END WORLD-ANCHORED BUTTONS ===== -->

    </a-scene>

    <script>
        /* --------- Autoplay helper (for panoVideo) --------- */
        (function () {
        const video = document.getElementById('panoVideo');
        const btn = document.getElementById('playBtn');

        function tryPlay() {
            if (!video) return;
            const p = video.play();
            if (p && typeof p.then === 'function') {
            p.then(() => { if (btn) btn.hidden = true; })
            .catch(() => { if (btn) btn.hidden = false; });
            }
        }

        if (video && video.readyState >= 2) tryPlay();
        else if (video) video.addEventListener('loadeddata', tryPlay, { once: true });

        ['click','touchend'].forEach(evt => {
            window.addEventListener(evt, tryPlay, { once: true });
            if (btn) btn.addEventListener(evt, tryPlay, { once: true });
        });
        })();

        /* --------- Fade helpers --------- */
        function fadeInFromBlack(dur = 600) {
        const fade = document.getElementById('screenFade');
        if (!fade) return;
        fade.setAttribute('material', 'opacity', 1);
        fade.setAttribute('animation__fadein', {
            property: 'material.opacity',
            from: 1, to: 0,
            dur, easing: 'easeInOutQuad'
        });
        }

        function fadeTo(url, dur = 600) {
        const fade = document.getElementById('screenFade');
        if (!fade) { window.location.href = url; return; }
        fade.setAttribute('animation__fadeout', {
            property: 'material.opacity',
            to: 1,
            dur, easing: 'easeInOutQuad'
        });
        fade.addEventListener('animationcomplete__fadeout',
            () => { window.location.href = url; },
            { once: true }
        );
        }

        // Run fade-in when scene is ready
        document.addEventListener('DOMContentLoaded', () => {
        const scene = document.querySelector('a-scene');
        if (scene && scene.hasLoaded) fadeInFromBlack();
        else if (scene) scene.addEventListener('loaded', () => fadeInFromBlack(), { once: true });
        });

        /* --------- UI component (buttons with hover + fuse + auto-activate) --------- */
        AFRAME.registerComponent('ui-button', {
        schema: { url:{type:'string'}, label:{type:'string', default:''} },
        init: function () {
            const el = this.el;
            const data = this.data;
            const baseTint  = '#2C3E50';
            const hoverTint = '#4AA3FF';
            const hoverTime = 3000; // 3 seconds hover to activate
            let hoverTimer = null;

            el.classList.add('clickable');
            const bg = el.querySelector('.bg');
            const progress = el.querySelector('.progress');

            // Hover polish + fuse timer
            el.addEventListener('mouseenter', () => {
            if (bg) bg.setAttribute('material', 'color', hoverTint);
            el.object3D.scale.set(1.05, 1.05, 1);

            // Start progress animation
            if (progress) {
                progress.setAttribute('scale', '0.001 0.001 0.001');
                progress.setAttribute('animation__grow', {
                property: 'scale',
                to: '1 1 1',
                dur: hoverTime,
                easing: 'linear'
                });
            }

            // Trigger fade navigation automatically after 3s
            hoverTimer = setTimeout(() => {
                if (data.url) fadeTo(data.url, 600);
            }, hoverTime);
            });

            el.addEventListener('mouseleave', () => {
            if (bg) bg.setAttribute('material', 'color', baseTint);
            el.object3D.scale.set(1, 1, 1);
            if (progress) {
                progress.removeAttribute('animation__grow');
                progress.setAttribute('scale', '0 0 0');
            }
            if (hoverTimer) {
                clearTimeout(hoverTimer);
                hoverTimer = null;
            }
            });
        }
        });

        /* --------- Box interactions --------- */
        document.addEventListener('DOMContentLoaded', () => {
        const box1 = document.querySelector('#box1');
        const box2 = document.querySelector('#box2');
        const box3 = document.querySelector('#box3');
        const text1Wrapper = document.querySelector('#text1Wrapper');
        const text2Wrapper = document.querySelector('#text2Wrapper');
        const text3Wrapper = document.querySelector('#text3Wrapper');

        if (!box1 || !box2 || !box3) return;

        // Box 1
        box1.addEventListener('mouseenter', () => {
            if (text1Wrapper) text1Wrapper.setAttribute('visible', true);
            setTimeout(() => {
            if (box2) box2.setAttribute('visible', true);
            }, 1500);
        });
        box1.addEventListener('mouseleave', () => {
            if (text1Wrapper) text1Wrapper.setAttribute('visible', false);
        });

        // Box 2
        box2.addEventListener('mouseenter', () => {
            if (text2Wrapper) text2Wrapper.setAttribute('visible', true);
            setTimeout(() => {
            if (box3) box3.setAttribute('visible', true);
            }, 1500);
        });
        box2.addEventListener('mouseleave', () => {
            if (text2Wrapper) text2Wrapper.setAttribute('visible', false);
        });

        // Box 3
        box3.addEventListener('mouseenter', () => {
            if (text3Wrapper) text3Wrapper.setAttribute('visible', true);
        });
        box3.addEventListener('mouseleave', () => {
            if (text3Wrapper) text3Wrapper.setAttribute('visible', false);
        });
        });

        /* --------- Ensure video playback for #video360 --------- */
        window.addEventListener('load', () => {
        const video = document.querySelector('#video360');
        if (video) {
            video.play().catch(err => console.warn('Autoplay prevented:', err));
        }
        });
     </script>

  </body>
</html>
