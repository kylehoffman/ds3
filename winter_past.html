<!DOCTYPE html>
<html>
<head>
  <title>360° Video with A-Frame — Present</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    #playBtn{
      position:absolute; inset:auto 0 30px 0; margin:0 auto;
      width:max-content; padding:10px 16px; border-radius:8px;
      background:rgba(0,0,0,.6); color:#fff; font-family:sans-serif; cursor:pointer; z-index:5;
    }
  </style>
</head>
<body>

  <button id="playBtn" hidden>Tap to Play Video</button>

  <a-scene>
    <a-assets>
      <video id="panoVideo"
             src="winterPast.mp4"
             crossorigin="anonymous"
             preload="auto"
             autoplay muted loop
             playsinline webkit-playsinline>
      </video>

      <!-- Single reusable rounded-rect SVG (transparent corners) -->
      <img id="btnBg" crossorigin="anonymous"
           src='data:image/svg+xml;utf8,
           <svg xmlns="http://www.w3.org/2000/svg" width="500" height="140" viewBox="0 0 500 140">
             <rect x="0" y="0" width="500" height="140" rx="24" ry="24"
                   fill="%23FFFFFF" fill-opacity="1"/>
           </svg>'>
      <!-- Note: we tint this via material color; white base lets tints look crisp. -->
    </a-assets>

    <!-- 360 sky video -->
    <a-sky src="#panoVideo" rotation="0 -90 0"></a-sky>

    <!-- CAMERA + CURSOR (gaze) -->
    <a-entity id="rig" position="0 0 0">
      <a-entity id="head"
                camera
                look-controls
                position="0 1.6 0"
                cursor="fuse: true; fuseTimeout: 3000; rayOrigin: entity"
                raycaster="objects: .clickable">

        <a-entity id="reticle"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.015; segmentsTheta: 64"
                  material="shader: flat; color: #FFFFFF; opacity: 0.9">
        </a-entity>

        <!-- Head-locked black overlay used for fades (covers whole view) -->
        <a-entity id="screenFade"
                  position="0 0 -0.25"
                  geometry="primitive: plane; width: 2.2; height: 2.2"
                  material="color: #000000; opacity: 1; shader: flat; transparent: true; depthTest: false">
        </a-entity>
      </a-entity>
    </a-entity>

    <!-- ===== WORLD-ANCHORED BUTTONS (rounded via SVG, no black plates/icons) ===== -->
    <a-entity id="uiPanelRoot" position="-0.8 1.0 -2.0" rotation="0 0 0">

      <!-- Button: Present -->
      <a-entity id="btnPresent" class="clickable"
                ui-button="url: winterPresent.html; label: Present"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 0 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Present; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Past -->
      <a-entity id="btnPast" class="clickable"
                ui-button="url: winterPast.html; label: Past"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.11 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Past; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Future -->
      <a-entity id="btnFuture" class="clickable"
                ui-button="url: winterFuture.html; label: Future"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.22 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Future; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

      <!-- Button: Home -->
      <a-entity id="btnHome" class="clickable"
                ui-button="url: index.html; label: Home"
                geometry="primitive: plane; width: 0.28; height: 0.08"
                material="transparent: true; opacity: 0; shader: flat"
                position="0 -0.33 0.001">
        <a-image class="bg" src="#btnBg" width="0.28" height="0.08"
                 material="shader: flat; color: #2C3E50; opacity: 0.70; transparent: true"
                 position="0 0 0.0005"></a-image>
        <a-entity text="value: Home; color: #FFFFFF; align: center; baseline: center; width: 1.6"
                  position="0 0 0.0015"></a-entity>
        <a-entity class="progress"
                  geometry="primitive: ring; radiusInner: 0.001; radiusOuter: 0.011; segmentsTheta: 64"
                  material="color: #FFFFFF; opacity: 0.9; shader: flat"
                  position="0 0 0.002"
                  scale="0 0 0"></a-entity>
      </a-entity>

    </a-entity>
    <!-- ===== END WORLD-ANCHORED BUTTONS ===== -->

  </a-scene>

  <script>
    /* --------- Autoplay helper (unchanged) --------- */
    (function () {
      const video = document.getElementById('panoVideo');
      const btn = document.getElementById('playBtn');

      function tryPlay() {
        if (!video) return;
        const p = video.play();
        if (p && typeof p.then === 'function') {
          p.then(() => { btn.hidden = true; }).catch(() => { btn.hidden = false; });
        }
      }

      if (video.readyState >= 2) tryPlay();
      else video.addEventListener('loadeddata', tryPlay, { once: true });

      ['click','touchend'].forEach(evt => {
        window.addEventListener(evt, tryPlay, { once: true });
        btn.addEventListener(evt, tryPlay, { once: true });
      });
    })();

    /* --------- Fade helpers (new) --------- */
    function fadeInFromBlack(dur = 600) {
      const fade = document.getElementById('screenFade');
      if (!fade) return;
      // start fully black, then fade to clear
      fade.setAttribute('material', 'opacity', 1);
      fade.setAttribute('animation__fadein', {
        property: 'material.opacity',
        from: 1, to: 0,
        dur, easing: 'easeInOutQuad'
      });
    }

    function fadeTo(url, dur = 600) {
      const fade = document.getElementById('screenFade');
      if (!fade) { window.location.href = url; return; }
      // fade to black then navigate
      fade.setAttribute('animation__fadeout', {
        property: 'material.opacity',
        to: 1,
        dur, easing: 'easeInOutQuad'
      });
      fade.addEventListener('animationcomplete__fadeout',
        () => { window.location.href = url; },
        { once: true }
      );
    }

    // Run fade-in once the scene is ready
    document.addEventListener('DOMContentLoaded', () => {
      const scene = document.querySelector('a-scene');
      if (scene && scene.hasLoaded) fadeInFromBlack();
      else scene.addEventListener('loaded', () => fadeInFromBlack(), { once: true });
    });

    /* --------- UI component: hover + fuse + route (with tinted bg + fade) --------- */
    AFRAME.registerComponent('ui-button', {
      schema: { url:{type:'string'}, label:{type:'string', default:''} },
      init: function () {
        const el = this.el;
        const data = this.data;
        const baseTint  = '#2C3E50';
        const hoverTint = '#4AA3FF';

        el.classList.add('clickable');

        const bg = el.querySelector('.bg');
        const progress = el.querySelector('.progress');

        // Hover polish
        el.addEventListener('mouseenter', () => {
          if (bg) bg.setAttribute('material', 'color', hoverTint);
          el.object3D.scale.set(1.05, 1.05, 1);
        });
        el.addEventListener('mouseleave', () => {
          if (bg) bg.setAttribute('material', 'color', baseTint);
          el.object3D.scale.set(1, 1, 1);
          if (progress) {
            progress.removeAttribute('animation__grow');
            progress.setAttribute('scale', '0 0 0');
          }
        });

        // Fuse progress
        el.addEventListener('fusing', () => {
          if (!progress) return;
          progress.setAttribute('scale', '0.001 0.001 0.001');
          progress.setAttribute('animation__grow', {
            property: 'scale',
            to: '1 1 1',
            dur: 3000,
            easing: 'linear'
          });
        });

        // Navigate after fuse click WITH fade-out
        el.addEventListener('click', () => {
          if (data.url) fadeTo(data.url, 600);
        });
      }
    });
  </script>

</body>
</html>
